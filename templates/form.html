<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>休暇申請</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
<div class="container">
  <h1>休暇申請</h1>

  <form action="/confirm" method="post">

    <!-- 所属 -->
    <label>所属</label>
    <select name="department" required>
      <option value="">選択してください</option>
      <option>野菜部</option>
      <option>果実部</option>
      <option>管理部</option>
    </select>

    <!-- 氏名 -->
    <label>氏名</label>
    <input type="text" name="name" required>

    <!-- 休暇期間 -->
    <label>休暇期間</label>
    <div class="date-row">
      <input type="date" id="start" name="start" required>
      <span>〜</span>
      <input type="date" id="end" name="end" required>
    </div>

    <div class="days">
      <span id="days">1</span> 日間
    </div>

    <!-- 理由 -->
    <label>申請理由</label>
    <select id="reason" name="reason" required>
      <option value="">選択してください</option>
      <option>私用の為</option>
      <option>体調不良の為</option>
      <option>家族の看護の為</option>
      <option>行事の為</option>
      <option value="other">その他</option>
    </select>

    <!-- その他入力 -->
    <textarea id="otherReason" name="other_reason"
      placeholder="理由を入力してください"></textarea>
    
    <label>種類</label>
    <select name="vacation_type">
      <option value="有給休暇" selected>有給休暇</option>
      <option value="特別休暇">特別休暇</option>
      <option value="欠勤">欠勤</option>
    </select>

    <label>備考</label>
    <textarea name="note" rows="3" placeholder="自由記入"></textarea>

    <button type="submit">申請する</button>
    <input type="hidden" name="days" id="daysInput">
  </form>
</div>

<script>
const start = document.getElementById("start");
const end = document.getElementById("end");
const days = document.getElementById("days");
const daysInput = document.getElementById("daysInput");

let autoMode = true; // ← 自動計算フラグ

start.addEventListener("change", () => {
  if (!end.value) {
    end.value = start.value;
    autoMode = true;
  }
  calcDays();
});

end.addEventListener("change", () => {
  // 日付②を触ったら自動解除
  autoMode = false;
  days.textContent = "";
  daysInput.value = "";
});

function calcDays() {
  if (!autoMode) return;

  const s = new Date(start.value);
  const e = new Date(end.value);
  const diff = (e - s) / (1000 * 60 * 60 * 24) + 1;
  const d = diff > 0 ? diff : 1;

  days.textContent = d;
  daysInput.value = d;
}
</script>
</body>
</html>
